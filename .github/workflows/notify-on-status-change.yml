name: Notificaci칩n por cambios de estado en Upptime

on:
  push:
    branches:
      - master

jobs:
  notify:
    name: Notificar por Telegram si cambia el estado
    runs-on: ubuntu-latest

    steps:
      - name: Checkout del repositorio
        uses: actions/checkout@v4
        
      - name: Extraer mensaje del 칰ltimo commit
        id: estado
        run: |
          COMMIT_MSG=$(git log -1 --pretty=%B)
          echo "칔ltimo commit: $COMMIT_MSG"

          # Determinar el tipo de cambio
          if echo "$COMMIT_MSG" | grep -q "游린"; then
            echo "estado=down" >> $GITHUB_OUTPUT
          elif echo "$COMMIT_MSG" | grep -q "游릴"; then
            echo "estado=up" >> $GITHUB_OUTPUT
          else
            echo "estado=none" >> $GITHUB_OUTPUT
          fi

      - name: Enviar notificaci칩n si hubo ca칤da
        if: ${{ steps.estado.outputs.estado == 'down' }}
        run: |
          curl -s -X POST "https://api.telegram.org/bot${{ secrets.TELEGRAM_TOKEN }}/sendMessage" \
            -d chat_id="${{ secrets.TELEGRAM_CHAT_ID }}" \
            -d text="游뚿 Ca칤da detectada por Upptime del ambiente de producci칩n. Verifica 游녤 https://Suns2794.github.io/ariaxa-upptime/"
